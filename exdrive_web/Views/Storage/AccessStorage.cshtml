<!DOCTYPE html>
<html lang="en">

<head>
    <meta chaster="UTF-8">
    <link rel="stylesheet" href="../wwwroot/css/storage.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@1,300&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato&display=swap" rel="stylesheet">
</head>
<body>
    <div class="ccontext-menu">
        <div class="ccontext-menu__item1">Link</div>
        <div class="ccontext-menu__item2">Favourite</div>
        <div class="ccontext-menu__item3">Rename</div>
        <div class="ccontext-menu__divider"></div>
        <div class="ccontext-menu__item4">Delete</div>
    </div>
    @if (TempData["LinkGet"] != null)
    {
            <div class="alert-context">
                <a href=@TempData["LinkGet"] style="color:#eeeeee;">@TempData["LinkGet"]</a>
            </div>
    }

    <div class="buttons__rect">
        <form asp-controller="Storage" asp-action="SinglePermFile" enctype="multipart/form-data">
            <div class="upload-btn-wrapper__upload">
                <button class="btn__upload">Upload</button>
                <input type="file" name="myfile" />
            </div>
            <div class="upload-btn-wrapper__submit">
                <button class="btn__submit">Submit</button>
            </div>
        </form>
    </div>

    @using (Html.BeginForm("FilterFav", "Storage"))
    {
            <button class="btn__heart">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bookmark-heart" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 4.41c1.387-1.425 4.854 1.07 0 4.277C3.146 5.48 6.613 2.986 8 4.412z" />
                    <path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.777.416L8 13.101l-5.223 2.815A.5.5 0 0 1 2 15.5V2zm2-1a1 1 0 0 0-1 1v12.566l4.723-2.482a.5.5 0 0 1 .554 0L13 14.566V2a1 1 0 0 0-1-1H4z" />
                </svg>
            </button>
    }
    @using (Html.BeginForm("Delete", "Storage"))
    {
            <button class="btn__delete" type="submit" value="delete">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash3" viewBox="0 0 16 16">
                    <path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5ZM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0H11Zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5h9.916Zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47ZM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5Z" />
                </svg>
            </button>
    }

    @using (Html.BeginForm("DownloadFiles", "Storage"))
    {
            <div></div>
            <button class="btn__download" type="submit" value="delete">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cloud-arrow-down" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M7.646 10.854a.5.5 0 0 0 .708 0l2-2a.5.5 0 0 0-.708-.708L8.5 9.293V5.5a.5.5 0 0 0-1 0v3.793L6.354 8.146a.5.5 0 1 0-.708.708l2 2z" />
                    <path d="M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383zm.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z" />
                </svg>
            </button>
    }
    @using (Html.BeginForm("Search", "Storage"))
    {
            <input type="search" placeholder="Enter file name" value="@ViewData["GetFiles"]" name="searchString" style="width:400px; margin-left:460px; top: 93px; position:absolute;" />
            <input type="submit" value="Search" class="search__button" />
    }
    @using (Html.BeginForm("Rename", "Storage"))
    {
            <input type="search" placeholder="Enter new file name" value="@ViewData["Rename"]" name="newName" style="width:200px; margin-left:460px; top: 550px; position:absolute;" />
            @*<input type="submit" value="Rename" class="search__button" />*@
    }
    @using (Html.BeginForm("ReadFile", "Storage"))
    {
            <input type="submit" value="Open file" class="openfile__button" />
    }
    @using (Html.BeginForm("Trashcan", "Trashcan"))
    {
            <input type="submit" value="Trashcan" class="trashcanstorage__button" />
    }

    <div class="storage__window">
        @model List<NameInstance>
        @using (Html.BeginForm("FileClick", "Storage"))
        {
            int count = 0;
            @foreach (var row in @Model)
            {
                if (row.Name != null && row.IsFavourite == false)
                {
                    string type = "";
                    @for (int i = row.Name.LastIndexOf('.') + 1; i < row.Name.Length; i++)
                    {
                        type += row.Name.ElementAt(i);
                    }

                    string imagetoview = "";
                    switch (type)
                    {
                        case "png":
                            imagetoview = "~/css/images/png.png";
                            break;
                        case "jpg":
                            imagetoview = "~/css/images/jpg.png";
                            break;
                        case "pdf":
                            imagetoview = "~/css/images/pdf.png";
                            break;
                        case "mp4":
                            imagetoview = "~/css/images/mp4.png";
                            break;
                        case "txt":
                            imagetoview = "~/css/images/txt.png";
                            break;
                        case "mp3":
                            imagetoview = "~/css/images/mp3.png";
                            break;
                        case "doc":
                            imagetoview = "~/css/images/doc.png";
                            break;
                        case "docx":
                            imagetoview = "~/css/images/docx.png";
                            break;
                        case "xls":
                            imagetoview = "~/css/images/xls.png";
                            break;
                        case "xlsx":
                            imagetoview = "~/css/images/xlsx.png";
                            break;
                        case "mov":
                            imagetoview = "~/css/images/mov.png";
                            break;
                        case "webm":
                            imagetoview = "~/css/images/webm.png";
                            break;
                        case "zip":
                            imagetoview = "~/css/images/zip.png";
                            break;
                        case "gif":
                            imagetoview = "~/css/images/gif.png";
                            break;
                        default:
                            imagetoview = "~/css/images/file.png";
                            break;
                    }
                                <div class="item" title="@row.Name" value=@count style="border: medium none">
                                    <img src="@Url.Content(imagetoview)" value=@count runat="server" style="border: medium none; width: 100px; height: 100px; border-radius: 15px;" />
                                    <span class="caption">@row.Name</span>
                                </div>
                    count++;
                }
                else
                if (row.Name != null && row.IsFavourite == true)
                {
                    string type = "";
                    @for (int i = row.Name.LastIndexOf('.') + 1; i < row.Name.Length; i++)
                    {
                        type += row.Name.ElementAt(i);
                    }

                    string imagetoview = "";
                    switch (type)
                    {
                        case "png":
                            imagetoview = "~/css/images/pngfav.png";
                            break;
                        case "jpg":
                            imagetoview = "~/css/images/jpgfav.png";
                            break;
                        case "pdf":
                            imagetoview = "~/css/images/pdffavourite.png";
                            break;
                        case "mp4":
                            imagetoview = "~/css/images/mp4fav.png";
                            break;
                        case "txt":
                            imagetoview = "~/css/images/txtfav.png";
                            break;
                        case "mp3":
                            imagetoview = "~/css/images/mp3fav.png";
                            break;
                        case "doc":
                            imagetoview = "~/css/images/docfav.png";
                            break;
                        case "docx":
                            imagetoview = "~/css/images/docxfav.png";
                            break;
                        case "xls":
                            imagetoview = "~/css/images/xlsfav.png";
                            break;
                        case "xlsx":
                            imagetoview = "~/css/images/xlsxfav.png";
                            break;
                        case "mov":
                            imagetoview = "~/css/images/movfav.png";
                            break;
                        case "webm":
                            imagetoview = "~/css/images/webmfavourite.png";
                            break;
                        case "zip":
                            imagetoview = "~/css/images/zipfav.png";
                            break;
                        case "gif":
                            imagetoview = "~/css/images/giffavourite.png";
                            break;
                        default:
                            imagetoview = "~/css/images/filefavourite.png";
                            break;
                    }
                     <div class="item" title="@row.Name" value=@count style="border: medium none">
                    <img src="@Url.Content(imagetoview)" value=@count runat="server" style="border: medium none; width: 100px; height: 100px; border-radius: 15px;" />
                     <span class="caption">@row.Name</span>
                    </div>
                    count++;
                }
            }
        }

    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>

        const cm = document.querySelector('.ccontext-menu');
        const deletebtn = document.querySelector('.ccontext-menu__item4');
        const linkbtn = document.querySelector('.ccontext-menu__item1');
        const favbtn = document.querySelector('.ccontext-menu__item2');

        function showContextMenu (show = true) {
            cm.style.display = show ? 'block' : 'none';
        }

        linkbtn.addEventListener('click', function(event) {
           $.ajax({
            url: '@Url.Action("GetLink","Storage")'
            }).done(function() {
                window.location = window.location.href;
            });
        });

        favbtn.addEventListener('click', function(event) {
           $.ajax({
            url: '@Url.Action("Favourite","Storage")'
            }).done(function() {
                window.location = window.location.href;
            });
        });

        deletebtn.addEventListener('click', function(event) {
           $.ajax({
            url: '@Url.Action("Delete","Storage")'
            }).done(function() {
                window.location = window.location.href;
            });
        });

        window.addEventListener('click', (e) => {

            let pos = e.target.getAttribute("value");
            if (pos != null)
            {
                console.log(pos);
                $.ajax({
            url: '@Url.Action("FileClick","Storage")',
            data: { afile: pos }
            }).done(function() {
                if (e.target.style.border == "medium none")
                    e.target.style.border = "inset #408aff 8px";
                else
                    e.target.style.border = "medium none";
            });
            }
        });

        window.addEventListener('contextmenu', (e) => {

            e.preventDefault();

            showContextMenu();

            cm.style.top = e.y + cm.offsetHeight > window.innerHeight ?
            window.innerHeight - cm.offsetHeight + "px" : e.y + "px";

            cm.style.left = e.x + cm.offsetWidth > window.innerWidth ?
            window.innerWidth - cm.offsetWidth + "px" : e.x + "px";

            console.log(e.returnValue);
        });

        window.addEventListener('click', () => {
            showContextMenu(false);
        });
    </script>   
</body>
</html>

