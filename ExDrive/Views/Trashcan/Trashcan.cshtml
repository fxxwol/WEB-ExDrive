@using ExDrive.Models
<!DOCTYPE html>
<html lang="en">
<head>
    <meta chaster="UTF-8">
    <link rel="stylesheet" href="~/css/trashcan.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@1,300&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato&display=swap" rel="stylesheet">
</head>
<body>
        <div class="buttons__rectangle8">
       
    </div>
    <div class="ccontext-menu">
        <div class="ccontext-menu__item1">Recover</div>
        <div class="ccontext-menu__divider"></div>
        <div class="ccontext-menu__item4">Delete</div>
    </div>

    @using (Html.BeginForm("DeletePermanentlyHandler", "Trashcan"))
    {
             <input type="submit" value="Delete" class="delete__button" title="Delete your file"/>
       
    }
    @using (Html.BeginForm("RecoverHandler", "Trashcan"))
    {
        <input type="submit" value="Recover" class="recovery__button" title="Recover your file"/>
    }
    @using (Html.BeginForm("SearchRedirectHandler", "Trashcan"))
    {
        <input type="search" placeholder="Enter file name" value="@ViewData["GetFiles"]" name="searchString" style="width:400px; margin-left:270px; top: 93px; position:absolute;" />
        <input type="submit" value="Search" class="search__button1" title="Search your file"/>
    }
   
 
  <div class="trashcan__window">
        @model List<UserFile>
        @using (Html.BeginForm("FileClickHandler", "Trashcan"))
        {
            int count = 0;
            @foreach (var row in @Model)
            {
                if (row.Name != null)
                {
                    string type = "";
                    @for (int i = row.Name.LastIndexOf('.') + 1; i < row.Name.Length; i++)
                    {
                        type += row.Name.ElementAt(i);
                    }

                    string imageToView = "";
                    switch (type)
                    {
                        case "png":
                                imageToView = "~/css/images/png.png";
                            break;
                        case "jpg":
                                imageToView = "~/css/images/jpg.png";
                            break;
                        case "pdf":
                                imageToView = "~/css/images/pdf.png";
                            break;
                        case "mp4":
                                imageToView = "~/css/images/mp4.png";
                            break;
                        case "txt":
                                imageToView = "~/css/images/txt.png";
                            break;
                        case "mp3":
                                imageToView = "~/css/images/mp3.png";
                            break;
                        case "doc":
                                imageToView = "~/css/images/doc.png";
                            break;
                        case "docx":
                                imageToView = "~/css/images/docx.png";
                            break;
                        case "xls":
                                imageToView = "~/css/images/xls.png";
                            break;
                        case "xlsx":
                                imageToView = "~/css/images/xlsx.png";
                            break;
                        case "mov":
                                imageToView = "~/css/images/mov.png";
                            break;
                        case "webm":
                                imageToView = "~/css/images/webm.png";
                            break;
                        case "zip":
                                imageToView = "~/css/images/zip.png";
                            break;
                        case "gif":
                                imageToView = "~/css/images/gif.png";
                            break;
                        default:
                                imageToView = "~/css/images/file.png";
                            break;
                    }

                    <div class="item" title="@row.Name" style="border: medium none">
                        <img src="@Url.Content(imageToView)" value=@count runat="server" style="border: medium none; width: 100px; height: 100px; border-radius: 15px;" />
                        <span class="caption">@row.Name</span>
                    </div>

                    count++;
                }
            }
        }
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>

        const cm = document.querySelector('.ccontext-menu');
        const deletebtn = document.querySelector('.ccontext-menu__item4');
        const recoverbtn = document.querySelector('.ccontext-menu__item1');

        function showContextMenu (show = true) {
            cm.style.display = show ? 'block' : 'none';
        }

        recoverbtn.addEventListener('click', function(event) {
           $.ajax({
            url: '@Url.Action("RecoverHandler","Trashcan")'
            }).done(function() {
                window.location = window.location.href;
            }); 
        });

        deletebtn.addEventListener('click', function(event) {
           $.ajax({
            url: '@Url.Action("DeletePermanentlyHandler","Trashcan")'
            }).done(function() {
            window.location = window.location.href;
            }); 
        });

        window.addEventListener('click', (e) => {
            
            let pos = e.target.getAttribute("value");
            if (pos != null && pos != 'Search' && pos < @Model.Count)
            {
                $.ajax({
            url: '@Url.Action("FileClickHandler","Trashcan")',
            data: { afile: pos }
            }).done(function() {
                if (e.target.style.border == "medium none")
                    e.target.style.border = "inset #408aff 8px";
                else
                    e.target.style.border = "medium none";
            });
            }
        });

        window.addEventListener('contextmenu', (e) => {

            e.preventDefault();

            showContextMenu();
            
            cm.style.top = e.y + cm.offsetHeight > window.innerHeight ?
            window.innerHeight - cm.offsetHeight + "px" : e.y + "px";

            cm.style.left = e.x + cm.offsetWidth > window.innerWidth ?
            window.innerWidth - cm.offsetWidth + "px" : e.x + "px";
        });

        window.addEventListener('click', () => {
            showContextMenu(false);
        });
    </script>

</body>
</html>